---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: ${{ values.name }}
spec:
  refreshInterval: "30d"
  target:
    name: ${{ values.name }}
    template:
      mergePolicy: Merge
      metadata:
        labels:
          cnpg.io/reload: "true"
      engineVersion: v2
      templateFrom:
      - target: Data
        literal: |-
          {{- $appname := "${{ values.name }}" }}
          user: {{ $appname | quote }}
          username: {{ $appname | quote }}
          dbname: {{ $appname | quote }}
          host: "central-rw.cnpg-cluster.svc.cluster.local"
          port: "5432"
          url: "postgres://{{ $appname }}:{{ .password }}@central-rw.cnpg-cluster.svc.cluster.local:5432/{{ $appname }}"
          password: {{ .password | quote }}
  dataFrom:
  - sourceRef:
      generatorRef:
        apiVersion: generators.external-secrets.io/v1alpha1
        kind: ClusterGenerator
        name: "factory"